version: "{build}"

pull_requests:
  do_not_increment_build_number: true

skip_branch_with_pr: true

image: Visual Studio 2017

before_build:
  - git submodule update --init --recursive
  - nuget restore IIS.Compression\Compression.sln

build_script:
  - msbuild IIS.Compression\Compression.sln /p:platform=x86 /p:configuration=Release /v:m
  - msbuild IIS.Compression\Compression.sln /p:platform=x64 /p:configuration=Release /v:m

test: off

after_build:
  - xcopy .\IIS.Compression\bin\Release\x86\* .\build\32bit\ /I
  - xcopy .\IIS.Compression\bin\Release\x64\* .\build\64bit\ /I
  - nuget pack .\IIS.Compression.SiteExtension.nuspec -BasePath .\build -OutputDirectory .\

artifacts:
  - path: '*.nupkg'